# Documentation de Configuration DNS (PRIVEE et PUBLIC)

## 1. Gestion des rôles et fonctionnalités DNS (PRIVEE)

### Capture d'écran :
![Gestionnaire de Serveur](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/ConfigDNS.png)

Dans le **Gestionnaire de serveur**, vous pouvez ajouter ou supprimer des rôles et fonctionnalités, gérer des serveurs ou créer des groupes de serveurs. Pour configurer ou modifier les fonctionnalités DNS, suivez les étapes ci-dessous :
1. Cliquer sur **Gérer** dans le menu en haut à droite.
2. Sélectionner **Ajouter des rôles et fonctionnalités** pour ajouter le rôle DNS si ce n'est pas déjà fait.
3. Suivre les instructions de l'assistant pour ajouter le rôle DNS.

## 2. Ouvrir le Gestionnaire DNS

### Capture d'écran :
![Gestionnaire DNS](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/DNS.png)

Le **Gestionnaire DNS** permet de gérer les zones DNS et d'administrer la résolution des noms dans un réseau. Dans cet exemple, deux zones de recherche directe sont configurées :
- **bourges.sportludique.fr** : Zone principale standard
- **lan.bourges.sportludique.fr** : Zone principale standard

L'état de ces zones est en cours d'exécution et DNSSEC n'est pas signé pour ces zones.

## 3. Détails de la zone `bourges.sportludique.fr`

### Capture d'écran :
![Détails Zone](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/DNS1.png)

Cette capture présente les enregistrements DNS pour la zone **bourges.sportludique.fr**. Voici les enregistrements configurés :
- **SOA (Start of Authority)** : Indique l'autorité principale pour la zone, ici le serveur `brg-winserv2019`.
- **NS (Name Server)** : Définit le serveur DNS autoritaire pour la zone, ici `brg-winserv2019`.
- **A (Host)** : L'enregistrement de type `A` associe le nom de domaine `www` à l'adresse IP `192.168.18.3`.
### Enregistrement du site www.bourges.sportludique.fr
![Enregistrement DNS www](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/Enregistrementwww.png)

### Enregistrement MX sur la zone bourges.sportludique.fr
Il faut ajouter un enregistrement MX et laisser la priorité par défaut 

![Enregistrement DNS](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/Enregistrement%20mail.png)

Ensuite il faut ajouter l'enregistrement IP du serveur de messagerie situé dans la DMZ Publique

![Enregistrement DNS](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/Enregistrement%20mail%20IP.png)

Voici tous les enregistrements à faire pour que tous soit 
![Enregistrement DNS](https://raw.githubusercontent.com/PatrickDummans/Bourges2025/refs/heads/main/images/Enregistrement%20DNS%20(LAN).png)

---
## DNS (DMZ Publique) - LINUX

Dans un premier temps, il faudra installer BIND :
`sudo apt install bind9 bind9utils bind9-doc`

Ensuite, il faut démarrer le service :
`sudo systemctl start bind9`

Pour activer le démarrage automatique de BIND au démarrage :
`sudo systemctl enable bind9`

Pour vérifier si le service BIND est bien activée : 
`sudo systemctl status bind9`

### Configuration de la zone bourges.sportludique.fr

Dirigez-vous vers le dossier " /etc/bind/ " et taper :
`sudo cp /etc/bind/db.empty /etc/bind/db.bourges.sportludique.fr`

Modifier le fichier  "db.bourges.sportludique.fr" pour créer la zone d'enregistrement en tapant la commande : `sudo nano /etc/bind/db.bourges.sportludique.fr` 

``` 
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$TTL    86400
@       IN      SOA     ns1.bourges.sportludique.fr. admin.bourges.sportludique.fr. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                          86400 )       ; Negative Cache TTL
;
@       IN      NS      ns1.bourges.sportludique.fr.

ns1.bourges.sportludique.fr.    IN      A       183.44.18.1

www     IN      A       183.44.18.1
blog    IN      CNAME   www.bourges.sportludique.fr.
mail    IN      A       183.44.18.1
@       IN      MX      10      mail

```
Signification de chaque partie :

 `IN` : Il s'agit de l'indicateur de classe. `IN` signifie "Internet", ce qui est normal dans les enregistrements DNS pour des services internet.

 `MX` : Il indique que l'enregistrement DNS est un serveur de messagerie.

 `CNAME`: Il indique que l'enregistrement DNS est un alias (Canonical Name), c'est-à-dire un alias vers un autre domaine ou sous-domaine.

 `A` : Il indique l'adresse IP d'un domaine donné. C'est le type le plus fondamental d'enregistrement DNS.

 `mail`: Il s'agit d'un enregistrement qui va prendre comme nom de domaine. 
 
 " mail.bourges.sportludique.fr "

 `www` : Il s'agit d'un enregistrement qui va prendre comme nom de domaine. 
 
 " www.bourges.sportludique.fr "

 `blog`: Il s'agit d'un enregistrement qui va prendre comme nom de domaine. 
 
 " blog.bourges.sportludique.fr "

Vérifier si la configuration de la zone est correcte avec cette commande :

`sudo named-checkzone bourges.sportludique.fr /etc/bind/db.bourges.sportludique.fr`

Redémarer BIND pour que la configuration soit bien prise en compte :

`sudo systemctl restart bind9`

`sudo systemctl reload bind9`

### Configuration du named.conf.local

``` 
//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your
// organization
//include "/etc/bind/zones.rfc1918";

zone "bourges.sportludique.fr." {
        type master;
        file "/etc/bind/db.bourges.sportludique.fr";
        //allow-update { none; };
};

``` 
### Configuration du named.conf.options
```
options {
        directory "/var/cache/bind";

        // If there is a firewall between you and nameservers you want
        // to talk to, you may need to fix the firewall to allow multiple
        // ports to talk.  See http://www.kb.cert.org/vuls/id/800113

        // If your ISP provided one or more IP addresses for stable
        // nameservers, you probably want to use them as forwarders.
        // Uncomment the following block, and insert the addresses replacing
        // the all-0's placeholder.
        recursion yes;

        allow-query {
                any;
            };  

         forwarders {
              121.183.90.205;
              172.28.64.2;      
         };

        auth-nxdomain no;    # conform to RFC1035
        // listen-on-v6 { any; };
        listen-on { any; };
        // allow-recursion { 127.0.0.1;};
        dnssec-validation no;
};

```

Une fois les configurations terminées, ouvrir une ligne commande en local et vérifier avec la commande `nslookup` ou `dig` que les enregistrement ressortent bien les bonnes adresses IP dont ici les adresses doivent être PUBLIQUE et non privé.
---

## Conclusion

Ce guide a présenté les principales étapes de la configuration DNS sur un serveur Windows, y compris l'ajout et la gestion des zones DNS, ainsi que la gestion des rôles via le Gestionnaire de serveur.
